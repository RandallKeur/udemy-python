name: Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  test:
    uses: ./.github/workflows/setup-python-and-install-deps.yml
    with:
      python-version: "3.12"
    steps:
    - name: Install additional test dependencies
      run: |
        pip install build pytest
    - name: Test
      run: |
        pytest --doctest-modules --junitxml=junit/test-results-${{ matrix.python-version }}.xml
    - name: Upload test results
      uses: actions/upload-artifact@v4
      with:
        name: pytest-results-${{ matrix.python-version }}
        path: junit/test-results-${{ matrix.python-version }}.xml
      if: ${{ always() }}